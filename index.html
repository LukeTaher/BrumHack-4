<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Algorekt</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  </head>
  <body>
    <canvas id="myCanvas" width="800" height="200" style="border:1px solid #000000;">
    </canvas>

    <script>
      //Browser Detection
      navigator.sayswho= (function(){
          var N= navigator.appName, ua= navigator.userAgent, tem;
          var M= ua.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);
          if(M && (tem= ua.match(/version\/([\.\d]+)/i))!= null) M[2]= tem[1];
          M= M? [M[1], M[2]]: [N, navigator.appVersion, '-?'];

          return M;
      })();

      var browser;
      if (navigator.sayswho[0] == "Firefox")
        browser="f";
      else if (navigator.sayswho[0] == "Chrome")
        browser="c";
      else if (navigator.sayswho[0] == "Safari")
        browser="s";
      else  if (navigator.sayswho[0] == "Microsoft")
        browser="m";
      else
        browser="f";

      var mouseX = 0; //default values
      var mouseY = 0; //default values
      var mouseVec = new Vector(mouseX, mouseY);


      var width = $(window).width()-40;
      var height = $(window).height()*8/10;


      var c = document.getElementById("myCanvas");

      //event listener for mouse
      c.addEventListener("click", canvasClick, false);
      c.addEventListener('mousemove', onMouseUpdate, false);

      c.width = width;
      c.height = height;
      var context = c.getContext("2d");

      var pos = 0;
      var mouseClicked = false;

      function canvasClick(event)
      {
        if (mouseClicked) {
          mouseClicked = !mouseClicked;
          if (browser == "f" || browser == "m") {
            var newMouseX = event.clientX - c.offsetLeft + document.documentElement.scrollLeft;
            var newMouseY = event.clientY - c.offsetTop + document.documentElement.scrollTop;
          }
          else { //"s" or "c"
            var newMouseX = event.clientX - c.offsetLeft + document.body.scrollLeft;
            var newMouseY = event.clientY - c.offsetTop + document.body.scrollTop;
          }
        }
        else {
          if (browser == "f" || browser == "m") {
            mouseX = event.clientX - c.offsetLeft + document.documentElement.scrollLeft;
            mouseY = event.clientY - c.offsetTop + document.documentElement.scrollTop;
          }
          else { //"s" or "c"
            mouseX = event.clientX - c.offsetLeft + document.body.scrollLeft;
            mouseY = event.clientY - c.offsetTop + document.body.scrollTop;
          }
        }
      }

      function onMouseUpdate(event)
      {
        if (browser == "f" || browser == "m") {
          var newMouseX = event.clientX - c.offsetLeft + document.documentElement.scrollLeft;
          var newMouseY = event.clientY - c.offsetTop + document.documentElement.scrollTop;
        }
        else { //"s" or "c"
          var newMouseX = event.clientX - c.offsetLeft + document.body.scrollLeft;
          var newMouseY = event.clientY - c.offsetTop + document.body.scrollTop;
        }
      }

      var totalString = [];
      totalString.push("public static int[] sort(int[] array) {");
      var highlights = ["boolean", "byte", "char", "double", "float","int","long","short", 
        "String", "if", "while", "for", "break", "else", "switch", "case", "true", "false"];

      function game(){
        context.clearRect(0, 0, c.width, c.height);
        context.fillStyle = '#f2f2f2';
        context.fillRect(0, 0, width, height);        
        context.fillStyle = "#444";
        context.fillStyle = getRandomColor();
        context.font = "20px Arial";
        var x = 10;
        var y = 30;
        var lineheight = 18;
        context.fillText(totalString[0], x, y);
        context.font = "15px Arial";
        y += 5;

        for (var i = 1; i<totalString.length; i++) {
          x = 40;
         words = totalString[i].split(" ");
          //alert(words);
          for (var j = 0; j < words.length; j++) {
            if (contains(highlights, words[j])) {
              context.fillStyle = getRandomColor();
            }
            else {
              context.fillStyle = "#444";
            }
            context.fillText(words[j], x, y + (i*lineheight) );
            x += context.measureText(words[j]+" ").width; 
          }
          //context.fillText(totalString[i], x, y + (i*lineheight) );
        }

      }

        function Vector(x, y) {
          this.x = x;
          this.y = y;
        }

        function normalise(vect) {
          var mag = Math.sqrt(vect.x*vect.x + vect.y*vect.y);
          return new Vector(vect.x/mag, vect.y/mag);
        }

        function multiply(vect, val){
          return new Vector(vect.x*val, vect.y*val);
        }

      function getRandomColor() {
          var letters = '0123456789ABCDEF'.split('');
          var color = '#';
          for (var i = 0; i < 6; i++ ) {
              color += letters[Math.floor(Math.random() * 16)];
          }
          return color;
      }

      function sendRequest(data, callback) {
          $.ajax({
              type: "POST",
              url: "pending",
              data: data,
              success: callback#
          });
      }

      function sendSource(src, user, otherUser, callback) {
          sendRequest({
              "raw": src,
              "user": user,
              "opp": otherUser
          }, callback);
      }

      $(function(){
       $("#text").keypress(function (e) {
          if (e.keyCode == 13) {
             totalString.push($('#text').html().substring(0, $('#text').html().length-4)); 
             $("#text").empty();
          }
        });
      });

    function contains(a, obj) {
      var i = a.length;
      while (i--) {
         if (a[i] == obj) {
            return true;
         }
      }
      return false;
    }

      myVar = setInterval(game, 50);

      srcSendLoop = setInterval(function() {
          sendSource(totalString.join("\n"), thisUser, otherUser, applyDisruptions);
      }, 1000);

      function applyDisruptions(src) {
          totalString = src.split("\n");
      }

    </script>
     <div style="width:100%">
        <div style="width:50%; top:0px;float:left;">
          <div id= "myName" onClick="this.contentEditable='true';" style="width:50%; top:0px;float;"><h2>You</h2></div>
          <div id="text" onClick="this.contentEditable='true';">lorem ipsum dolor lorem ipsum dolorlorem ipsum dolor</div>
        </div>
        <div style="width:50%; top:0px;float:left;">
          <div id= "theirName"onClick="this.contentEditable='false';" style="width:50%; top:0px;float;"><h2>Them<h2></div>
          <div id="theirText" onClick="this.contentEditable='false';">
            lorem ipsum dolor lorem ipsum dolorlorem ipsum dolor
          </div>
        </div>
    </div>
  </body>
</html>
